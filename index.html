<!DOCTYPE html>
<html lang="es">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>Malla de Ingeniería Sanitaria</title>
    <script src="https://cdn.jsdelivr.net/npm/jsplumb@2.15.6/dist/js/jsplumb.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(to right, #e8f5e9, #e3f2fd);
            margin: 0;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #1b5e20;
            margin-bottom: 20px;
        }
        #resetBtn {
            display: block;
            margin: 0 auto 20px auto;
            padding: 10px 20px;
            background-color: #4caf50;
            border: none;
            color: white;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        #resetBtn:hover {
            background-color: #43a047;
        }
        #container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .ciclo {
            border: 2px solid #81c784;
            background-color: #c8e6c9;
            border-radius: 12px;
            padding: 10px;
            min-width: 180px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .ciclo h2 {
            text-align: center;
            font-size: 1.1rem;
            color: #2e7d32;
            margin-top: 0;
            margin-bottom: 10px;
        }
        .ramo {
            background-color: #bbdefb;
            border: 2px solid #64b5f6;
            border-radius: 8px;
            padding: 8px;
            margin: 5px 0;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s, background-color 0.2s;
            width: 100%;
            text-align: left;
            font-size: 0.95rem;
            color: #1565c0;
            font-weight: 500;
        }
        .ramo:hover {
            transform: scale(1.03);
            box-shadow: 0 0 10px rgba(33, 150, 243, 0.4);
        }
        .ramo.aprobado {
            text-decoration: line-through;
            background-color: #a5d6a7;
            color: #1b5e20;
            border-color: #66bb6a;
        }
        .ramo:disabled {
            background-color: #e0e0e0;
            color: #9e9e9e;
            cursor: not-allowed;
            border-color: #bdbdbd;
        }

        /* Estilos para la barra de progreso */
        #progress-section {
            max-width: 1200px;
            margin: 20px auto;
            padding: 15px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            text-align: center;
        }
        #progress-section h2 {
            color: #1b5e20;
            margin-bottom: 10px;
            font-size: 1.5rem;
        }
        .progress-bar-container {
            width: 90%;
            max-width: 600px;
            height: 30px;
            background-color: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 15px auto;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
        }
        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(to right, #4CAF50, #8BC34A);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            transition: width 0.8s ease-out;
        }
        #progress-text {
            font-size: 1.1rem;
            color: #333;
            margin-top: 10px;
            font-weight: bold;
        }
        #motivation-message {
            font-style: italic;
            color: #555;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Malla Curricular - Ingeniería Sanitaria</h1>
    <button id="resetBtn">🔄 Reiniciar progreso</button>

    <!-- Sección de la barra de progreso -->
    <div id="progress-section">
        <h2>Tu Progreso en la Carrera</h2>
        <div class="progress-bar-container">
            <div id="progressBar" class="progress-bar">0%</div>
        </div>
        <p id="progress-text">0 de 0 cursos aprobados (0%)</p>
        <p id="motivation-message">¡Comienza a marcar tus cursos para ver tu avance!</p>
    </div>

    <div id="container"></div>

    <script>
        const ramos = [{"id": "BRN01", "nombre": "Redacción y comunicación", "ciclo": 1, "requisitos": []}, {"id": "BQU01", "nombre": "Química I", "ciclo": 1, "requisitos": []}, {"id": "BMA03", "nombre": "Álgebra Lineal", "ciclo": 1, "requisitos": []}, {"id": "BMA01", "nombre": "Cálculo Diferencial", "ciclo": 1, "requisitos": []}, {"id": "BIC01", "nombre": "Introducción a la computación", "ciclo": 1, "requisitos": []}, {"id": "AA215G", "nombre": "Geología", "ciclo": 1, "requisitos": []}, {"id": "SA312", "nombre": "Ecología", "ciclo": 2, "requisitos": ["BQU01"]}, {"id": "SA401", "nombre": "Química Sanitaria", "ciclo": 2, "requisitos": ["BQU01"]}, {"id": "BMA02", "nombre": "Cálculo Integral", "ciclo": 2, "requisitos": ["BMA01"]}, {"id": "BEG01", "nombre": "Economía General", "ciclo": 2, "requisitos": []}, {"id": "BF101", "nombre": "Física I", "ciclo": 2, "requisitos": []}, {"id": "AA237", "nombre": "Dibujo Técnico", "ciclo": 2, "requisitos": []}, {"id": "SA323", "nombre": "Microbiología Sanitaria I", "ciclo": 3, "requisitos": []}, {"id": "AA243", "nombre": "Fisicoquímica Aplicada", "ciclo": 3, "requisitos": ["BMA02", "SA401"]}, {"id": "AA241", "nombre": "Cálculo Multivariable", "ciclo": 3, "requisitos": ["BMA03", "BMA02"]}, {"id": "AA232", "nombre": "Bioestadística", "ciclo": 3, "requisitos": ["BMA02"]}, {"id": "AA234", "nombre": "Física II", "ciclo": 3, "requisitos": ["BF101"]}, {"id": "BEF01", "nombre": "Ética y Filosofía Política", "ciclo": 3, "requisitos": []}, {"id": "SA324", "nombre": "Microbiología Sanitaria II", "ciclo": 4, "requisitos": ["SA323"]}, {"id": "SA343", "nombre": "Epidemiología y Salud Pública", "ciclo": 4, "requisitos": ["SA323"]}, {"id": "EC115", "nombre": "Mecánica de Cuerpo Rígido", "ciclo": 4, "requisitos": ["AA234", "BMA02"]}, {"id": "MA153", "nombre": "Ecuaciones Diferenciales", "ciclo": 4, "requisitos": ["AA241"]}, {"id": "F1413", "nombre": "Física III", "ciclo": 4, "requisitos": ["AA234"]}, {"id": "BRN02", "nombre": "Realidad nacional, Constitución y DDHH", "ciclo": 4, "requisitos": []}, {"id": "SA413", "nombre": "Análisis de Agua y Desagüe", "ciclo": 5, "requisitos": ["SA323"]}, {"id": "SA467", "nombre": "Manejo y Trat. de Residuos Sólidos", "ciclo": 5, "requisitos": ["SA312"]}, {"id": "HH223", "nombre": "Mecánica de Fluidos I", "ciclo": 5, "requisitos": ["AA241", "EC115"]}, {"id": "EC125", "nombre": "Resistencia de Materiales", "ciclo": 5, "requisitos": ["EC115"]}, {"id": "AA215T", "nombre": "Topografía", "ciclo": 5, "requisitos": ["AA215G", "AA237"]}, {"id": "SA426", "nombre": "Procesos Unitarios I", "ciclo": 6, "requisitos": ["SA323", "SA413"]}, {"id": "SA468", "nombre": "Residuos Hospitalarios y Peligrosos", "ciclo": 6, "requisitos": ["SA467"]}, {"id": "HH224", "nombre": "Mecánica de Fluidos II", "ciclo": 6, "requisitos": ["HH223"]}, {"id": "HH113", "nombre": "Hidrología General", "ciclo": 6, "requisitos": ["HH223"]}, {"id": "EC611", "nombre": "Tecnología de Materiales", "ciclo": 6, "requisitos": ["EC125"]}, {"id": "SA427", "nombre": "Procesos Unitarios II", "ciclo": 7, "requisitos": ["SA426"]}, {"id": "SA416", "nombre": "Saneamiento Rural", "ciclo": 7, "requisitos": ["SA413", "HH224"]}, {"id": "EC411", "nombre": "Diseño de Estruct. Hidráulicas", "ciclo": 7, "requisitos": ["EC125"]}, {"id": "SA227", "nombre": "Aprovechamiento Aguas Subterráneas", "ciclo": 7, "requisitos": ["HH113"]}, {"id": "EE631", "nombre": "Instalaciones Eléctricas y Automatización", "ciclo": 7, "requisitos": ["F1413"]}, {"id": "SA126", "nombre": "Saneamiento Ambiental", "ciclo": 8, "requisitos": ["SA416"]}, {"id": "SA526", "nombre": "Máquinas y Equipos Sanitarios", "ciclo": 8, "requisitos": ["HH223"]}, {"id": "SA215", "nombre": "Abastecimiento de Agua I", "ciclo": 8, "requisitos": ["HH224", "SA227"]}, {"id": "SA516", "nombre": "Instalaciones Sanitarias en Edificaciones", "ciclo": 8, "requisitos": ["HH224"]}, {"id": "EC717", "nombre": "Procedimiento de Construcción", "ciclo": 8, "requisitos": ["EC611"]}, {"id": "SA465", "nombre": "Tratamiento de Desagües", "ciclo": 9, "requisitos": ["SA427"]}, {"id": "SA245", "nombre": "Alcantarillado y Drenaje Pluvial", "ciclo": 9, "requisitos": ["SA416"]}, {"id": "SA445", "nombre": "Tratamiento de Agua I", "ciclo": 9, "requisitos": ["SA215"]}, {"id": "SA216", "nombre": "Abastecimiento de Agua II", "ciclo": 9, "requisitos": ["SA215"]}, {"id": "SA517", "nombre": "Instalaciones Sanitarias Especiales", "ciclo": 9, "requisitos": ["SA516"]}, {"id": "SA475", "nombre": "Tratamiento Avanzado de Aguas Residuales", "ciclo": 10, "requisitos": ["SA465"]}, {"id": "SA446", "nombre": "Tratamiento de Agua II", "ciclo": 10, "requisitos": ["SA445"]}, {"id": "GA163", "nombre": "Innovación y Tesis I", "ciclo": 10, "requisitos": ["SA445", "SA465"]}, {"id": "SA921", "nombre": "Evaluación del Impacto Ambiental", "ciclo": 10, "requisitos": ["SA245", "SA216"]}, {"id": "SA235", "nombre": "Análisis de Redes y Fuentes de Agua", "ciclo": 10, "requisitos": ["SA216", "BIC01"]}];
        const container = document.getElementById('container');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progress-text');
        const motivationMessage = document.getElementById('motivation-message');

        const aprobados = new Set(JSON.parse(localStorage.getItem("aprobados") || "[]"));
        const totalRamos = ramos.length;

        function updateProgressBar() {
            const ramosAprobadosCount = aprobados.size;
            const percentage = totalRamos > 0 ? Math.round((ramosAprobadosCount / totalRamos) * 100) : 0;

            progressBar.style.width = `${percentage}%`;
            progressBar.textContent = `${percentage}%`;
            progressText.textContent = `${ramosAprobadosCount} de ${totalRamos} cursos aprobados (${percentage}%)`;

            if (percentage === 100) {
                motivationMessage.textContent = "¡Felicidades! Has completado todos los cursos de tu carrera. ¡Eres un Ingeniero Sanitario!";
                progressBar.style.background = 'linear-gradient(to right, #28a745, #218838)'; // Verde más oscuro al completar
            } else if (percentage >= 75) {
                motivationMessage.textContent = "¡Estás en la recta final! Sigue así, la meta está cerca.";
                progressBar.style.background = 'linear-gradient(to right, #4CAF50, #8BC34A)';
            } else if (percentage >= 50) {
                motivationMessage.textContent = "¡Más de la mitad del camino recorrido! Vas muy bien.";
                progressBar.style.background = 'linear-gradient(to right, #4CAF50, #8BC34A)';
            } else if (percentage > 0) {
                motivationMessage.textContent = "Cada curso te acerca más a tu objetivo. ¡No te rindas!";
                progressBar.style.background = 'linear-gradient(to right, #4CAF50, #8BC34A)';
            } else {
                motivationMessage.textContent = "¡Comienza a marcar tus cursos para ver tu avance!";
                progressBar.style.background = 'linear-gradient(to right, #4CAF50, #8BC34A)'; // Color inicial
            }
        }

        function render() {
            container.innerHTML = '';
            for (let i = 1; i <= 10; i++) {
                const cicloDiv = document.createElement("div");
                cicloDiv.className = "ciclo";
                cicloDiv.innerHTML = "<h2>Ciclo " + i + "</h2>";
                ramos.filter(r => r.ciclo === i).forEach(ramo => {
                    const btn = document.createElement("button");
                    btn.textContent = ramo.nombre;
                    btn.className = "ramo";
                    btn.id = ramo.id;
                    
                    // Verificar si los requisitos están aprobados
                    const puedeAprobar = ramo.requisitos.every(req => aprobados.has(req));
                    
                    if (!puedeAprobar && !aprobados.has(ramo.id)) {
                        btn.disabled = true;
                    }
                    
                    if (aprobados.has(ramo.id)) {
                        btn.classList.add("aprobado");
                    }
                    
                    btn.onclick = () => {
                        if (aprobados.has(ramo.id)) {
                            // Si el curso ya está aprobado, desaprobarlo
                            aprobados.delete(ramo.id);
                            // También desaprobar cualquier curso que dependa de este
                            ramos.forEach(r => {
                                if (r.requisitos.includes(ramo.id) && aprobados.has(r.id)) {
                                    aprobados.delete(r.id);
                                }
                            });
                        } else {
                            // Si el curso no está aprobado y sus requisitos sí, aprobarlo
                            if (puedeAprobar) {
                                aprobados.add(ramo.id);
                                btn.animate([{transform: "scale(1)"}, {transform: "scale(1.05)"}, {transform: "scale(1)"}], {
                                    duration: 300
                                });
                            } else {
                                alert("Debes aprobar los requisitos previos para este curso.");
                                return; // No hacer nada si no cumple los requisitos
                            }
                        }
                        localStorage.setItem("aprobados", JSON.stringify([...aprobados]));
                        render(); // Volver a renderizar para actualizar estados y barra de progreso
                    };
                    cicloDiv.appendChild(btn);
                });
                container.appendChild(cicloDiv);
            }
            updateProgressBar(); // Actualizar la barra de progreso después de renderizar los cursos
        }

        document.getElementById("resetBtn").onclick = () => {
            if (confirm("¿Estás seguro de que quieres reiniciar todo tu progreso? Esta acción no se puede deshacer.")) {
                localStorage.removeItem("aprobados");
                aprobados.clear();
                render();
            }
        };

        render(); // Renderizar la malla y la barra de progreso al cargar la página
    </script>
</body>
</html>
