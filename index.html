<!DOCTYPE html>
<html lang="es">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>Malla de IngenierÃ­a Sanitaria</title>
    <script src="https://cdn.jsdelivr.net/npm/jsplumb@2.15.6/dist/js/jsplumb.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(to right, #e8f5e9, #e3f2fd);
            margin: 0;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #1b5e20;
            margin-bottom: 20px;
        }
        #resetBtn {
            display: block;
            margin: 0 auto 20px auto;
            padding: 10px 20px;
            background-color: #4caf50;
            border: none;
            color: white;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        #resetBtn:hover {
            background-color: #43a047;
        }
        #container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .ciclo {
            border: 2px solid #81c784;
            background-color: #c8e6c9;
            border-radius: 12px;
            padding: 10px;
            min-width: 180px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .ciclo h2 {
            text-align: center;
            font-size: 1.1rem;
            color: #2e7d32;
            margin-top: 0;
            margin-bottom: 10px;
        }
        .ramo {
            background-color: #bbdefb;
            border: 2px solid #64b5f6;
            border-radius: 8px;
            padding: 8px;
            margin: 5px 0;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s, background-color 0.2s;
            width: 100%;
            text-align: left;
            font-size: 0.95rem;
            color: #1565c0;
            font-weight: 500;
        }
        .ramo:hover {
            transform: scale(1.03);
            box-shadow: 0 0 10px rgba(33, 150, 243, 0.4);
        }
        .ramo.aprobado {
            text-decoration: line-through;
            background-color: #a5d6a7;
            color: #1b5e20;
            border-color: #66bb6a;
        }
        .ramo:disabled {
            background-color: #e0e0e0;
            color: #9e9e9e;
            cursor: not-allowed;
            border-color: #bdbdbd;
        }

        /* Estilos para la barra de progreso */
        #progress-section {
            max-width: 1200px;
            margin: 20px auto;
            padding: 15px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            text-align: center;
        }
        #progress-section h2 {
            color: #1b5e20;
            margin-bottom: 10px;
            font-size: 1.5rem;
        }
        .progress-bar-container {
            width: 90%;
            max-width: 600px;
            height: 30px;
            background-color: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 15px auto;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
        }
        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(to right, #4CAF50, #8BC34A);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            transition: width 0.8s ease-out;
        }
        #progress-credits-text {
            font-size: 1.1rem;
            color: #333;
            margin-top: 10px;
            font-weight: bold;
        }
        #motivation-message {
            font-style: italic;
            color: #555;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Malla Curricular - IngenierÃ­a Sanitaria</h1>
    <button id="resetBtn">ðŸ”„ Reiniciar progreso</button>

    <!-- SecciÃ³n de la barra de progreso -->
    <div id="progress-section">
        <h2>Tu Progreso en la Carrera</h2>
        <div class="progress-bar-container">
            <div id="progressBar" class="progress-bar">0%</div>
        </div>
        <p id="progress-credits-text">0 de 215 crÃ©ditos aprobados (0%)</p>
        <p id="motivation-message">Â¡Comienza a marcar tus cursos para ver tu avance!</p>
    </div>

    <div id="container"></div>

    <script>
        const ramos = [
            // 1er Ciclo
            {"id": "BRC01", "nombre": "RedacciÃ³n y comunicaciÃ³n", "ciclo": 1, "requisitos": [], "creditos": 2},
            {"id": "BQU01", "nombre": "QuÃ­mica I", "ciclo": 1, "requisitos": [], "creditos": 5},
            {"id": "BMA03", "nombre": "Ãlgebra Lineal", "ciclo": 1, "requisitos": [], "creditos": 4},
            {"id": "BMA01", "nombre": "CÃ¡lculo Diferencial", "ciclo": 1, "requisitos": [], "creditos": 5},
            {"id": "BIC01", "nombre": "IntroducciÃ³n a la computaciÃ³n", "ciclo": 1, "requisitos": [], "creditos": 2},
            {"id": "AA215", "nombre": "GeologÃ­a", "ciclo": 1, "requisitos": [], "creditos": 3},

            // 2do Ciclo
            {"id": "SA312", "nombre": "EcologÃ­a", "ciclo": 2, "requisitos": ["BQU01"], "creditos": 2},
            {"id": "SA401", "nombre": "QuÃ­mica Sanitaria", "ciclo": 2, "requisitos": ["BQU01"], "creditos": 3},
            {"id": "BMA02", "nombre": "CÃ¡lculo Integral", "ciclo": 2, "requisitos": ["BMA01"], "creditos": 5},
            {"id": "BEG01", "nombre": "EconomÃ­a General", "ciclo": 2, "requisitos": [], "creditos": 3},
            {"id": "BF101", "nombre": "FÃ­sica I", "ciclo": 2, "requisitos": [], "creditos": 5},
            {"id": "AA237", "nombre": "Dibujo TÃ©cnico", "ciclo": 2, "requisitos": [], "creditos": 2},

            // 3er Ciclo
            {"id": "SA323", "nombre": "MicrobiologÃ­a Sanitaria I", "ciclo": 3, "requisitos": [], "creditos": 5},
            {"id": "AA243", "nombre": "FisicoquÃ­mica Aplicada", "ciclo": 3, "requisitos": ["BMA02", "SA401"], "creditos": 3},
            {"id": "AA241", "nombre": "CÃ¡lculo Multivariable", "ciclo": 3, "requisitos": ["BMA03", "BMA02"], "creditos": 4},
            {"id": "AA232", "nombre": "BioestadÃ­stica", "ciclo": 3, "requisitos": ["BMA02"], "creditos": 4},
            {"id": "AA234", "nombre": "FÃ­sica II", "ciclo": 3, "requisitos": ["BF101"], "creditos": 4},
            {"id": "BEF01", "nombre": "Ã‰tica y FilosofÃ­a PolÃ­tica", "ciclo": 3, "requisitos": [], "creditos": 2},

            // 4to Ciclo
            {"id": "SA324", "nombre": "MicrobiologÃ­a Sanitaria II", "ciclo": 4, "requisitos": ["SA323"], "creditos": 3},
            {"id": "SA343", "nombre": "EpidemiologÃ­a y Salud PÃºblica", "ciclo": 4, "requisitos": ["SA323"], "creditos": 3},
            {"id": "EC115", "nombre": "MecÃ¡nica de Cuerpo RÃ­gido", "ciclo": 4, "requisitos": ["AA234", "BMA02"], "creditos": 4},
            {"id": "MA153", "nombre": "Ecuaciones Diferenciales", "ciclo": 4, "requisitos": ["AA241"], "creditos": 4},
            {"id": "F1413", "nombre": "FÃ­sica III", "ciclo": 4, "requisitos": ["AA234"], "creditos": 3},
            {"id": "BRN01", "nombre": "Realidad nacional, ConstituciÃ³n y DDHH", "ciclo": 4, "requisitos": [], "creditos": 3},

            // 5to Ciclo
            {"id": "SA413", "nombre": "AnÃ¡lisis de Agua y DesagÃ¼e", "ciclo": 5, "requisitos": ["SA323"], "creditos": 6},
            {"id": "SA467", "nombre": "Manejo y Trat. de Residuos SÃ³lidos", "ciclo": 5, "requisitos": ["SA312", "SA323"], "creditos": 3},
            {"id": "HH223", "nombre": "MecÃ¡nica de Fluidos I", "ciclo": 5, "requisitos": ["AA241", "EC115"], "creditos": 4},
            {"id": "EC125", "nombre": "Resistencia de Materiales", "ciclo": 5, "requisitos": ["EC115"], "creditos": 5},
            {"id": "AA215T", "nombre": "TopografÃ­a", "ciclo": 5, "requisitos": ["AA215", "AA237"], "creditos": 4},

            // 6to Ciclo
            {"id": "SA426", "nombre": "Procesos Unitarios en Ingenieria Sanitaria I", "ciclo": 6, "requisitos": ["SA323", "SA413"], "creditos": 3},
            {"id": "SA468", "nombre": "Ingenieria de Residuos Hospitalarios y Peligrosos", "ciclo": 6, "requisitos": ["SA467"], "creditos": 4},
            {"id": "HH224", "nombre": "MecÃ¡nica de Fluidos II", "ciclo": 6, "requisitos": ["HH223"], "creditos": 4},
            {"id": "HH113", "nombre": "HidrologÃ­a General", "ciclo": 6, "requisitos": ["HH223"], "creditos": 3},
            {"id": "EC611", "nombre": "TecnologÃ­a de Materiales", "ciclo": 6, "requisitos": ["EC125"], "creditos": 4},

            // 7mo Ciclo
            {"id": "SA427", "nombre": "Procesos Unitarios en Ingenieria Sanitaria II", "ciclo": 7, "requisitos": ["SA426"], "creditos": 3},
            {"id": "SA116", "nombre": "Saneamiento Rural", "ciclo": 7, "requisitos": ["SA413", "HH224"], "creditos": 4},
            {"id": "EC411", "nombre": "Analisis y DiseÃ±o de Estruct. HidrÃ¡ulicas", "ciclo": 7, "requisitos": ["EC125"], "creditos": 5},
            {"id": "SA227", "nombre": "Aprovechamiento Aguas SubterrÃ¡neas", "ciclo": 7, "requisitos": ["HH113"], "creditos": 4},
            {"id": "EE631", "nombre": "Instalaciones ElÃ©ctricas y AutomatizaciÃ³n", "ciclo": 7, "requisitos": ["F1413"], "creditos": 3},

            // 8vo Ciclo
            {"id": "SA126", "nombre": "Saneamiento Ambiental", "ciclo": 8, "requisitos": ["SA116"], "creditos": 4},
            {"id": "SA526", "nombre": "MÃ¡quinas y Equipos Sanitarios", "ciclo": 8, "requisitos": ["HH223"], "creditos": 3},
            {"id": "SA215", "nombre": "Abastecimiento de Agua I", "ciclo": 8, "requisitos": ["HH224", "SA227"], "creditos": 4},
            {"id": "SA516", "nombre": "Instalaciones Sanitarias en Edificaciones", "ciclo": 8, "requisitos": ["HH224"], "creditos": 4},
            {"id": "EC717", "nombre": "Procedimiento de ConstrucciÃ³n", "ciclo": 8, "requisitos": ["EC611"], "creditos": 4},

            // 9no Ciclo
            {"id": "SA465", "nombre": "Tratamiento de DesagÃ¼es", "ciclo": 9, "requisitos": ["SA427"], "creditos": 4},
            {"id": "SA245", "nombre": "Alcantarillado y Drenaje Pluvial", "ciclo": 9, "requisitos": ["SA215"], "creditos": 4},
            {"id": "SA445", "nombre": "Tratamiento de Agua I", "ciclo": 9, "requisitos": ["SA215"], "creditos": 4},
            {"id": "SA216", "nombre": "Abastecimiento de Agua II", "ciclo": 9, "requisitos": ["SA215"], "creditos": 4},
            {"id": "SA517", "nombre": "Instalaciones Sanitarias Especiales", "ciclo": 9, "requisitos": ["SA516"], "creditos": 3},

            // 10mo Ciclo
            {"id": "SA475", "nombre": "Tratamiento Avanzado de Aguas Residuales", "ciclo": 10, "requisitos": ["SA465"], "creditos": 3},
            {"id": "SA446", "nombre": "Tratamiento de Agua II", "ciclo": 10, "requisitos": ["SA445"], "creditos": 3},
            {"id": "GA163", "nombre": "InnovaciÃ³n y Tesis I", "ciclo": 10, "requisitos": ["SA445", "SA465"], "creditos": 4},
            {"id": "SA921", "nombre": "EvaluaciÃ³n del Impacto Ambiental", "ciclo": 10, "requisitos": ["SA245", "SA216"], "creditos": 3},
            {"id": "SA235", "nombre": "AnÃ¡lisis de Redes y Fuentes de Agua", "ciclo": 10, "requisitos": ["SA216", "BIC01"], "creditos": 3},

            // Electivos de la especialidad
            {"id": "AA214", "nombre": "Recursos Naturales", "ciclo": 11, "requisitos": ["SA312"], "tipo": "electivo", "creditos": 2},
            {"id": "AU411", "nombre": "Planeamiento Urbano y Regional", "ciclo": 11, "requisitos": [], "creditos": 3},
            {"id": "PA135", "nombre": "ProgramaciÃ³n de Obras", "ciclo": 11, "requisitos": ["EC717"], "creditos": 3},
            {"id": "SA135", "nombre": "Higiene Alimentaria", "ciclo": 11, "requisitos": ["SA126"], "creditos": 4},
            {"id": "SA172", "nombre": "ContaminaciÃ³n Ambiental", "ciclo": 11, "requisitos": ["SA116"], "creditos": 4},
            {"id": "SA266", "nombre": "Tarifas en IngenierÃ­a Sanitaria", "ciclo": 11, "requisitos": ["SA427"], "creditos": 4},
            {"id": "SA275", "nombre": "Operaciones, Mantenimiento y Gerencia de Proyectos", "ciclo": 11, "requisitos": ["SA216"], "creditos": 4},
            {"id": "SA447", "nombre": "Tratamiento Avanzado de Agua Potable", "ciclo": 11, "requisitos": ["SA445"], "creditos": 3},
            {"id": "SA466", "nombre": "Tratamiento de Desechos Industriales", "ciclo": 11, "requisitos": ["SA245"], "creditos": 3},
            {"id": "SA818", "nombre": "Costos y Presupuestos", "ciclo": 11, "requisitos": ["EC717"], "creditos": 3},
            {"id": "SA828", "nombre": "SupervisiÃ³n de Obras", "ciclo": 11, "requisitos": ["EC717", "SA216"], "creditos": 4},
            {"id": "SA923", "nombre": "PrevenciÃ³n contra Desastres Naturales", "ciclo": 11, "requisitos": ["SA116", "SA312"], "creditos": 2},

            // Electivos complementarios  
            {"id": "AA218", "nombre": "SociologÃ­a", "ciclo": 12, "requisitos": [], "creditos": 2},
            {"id": "AHD85", "nombre": "Informes TÃ©cnicos", "ciclo": 12, "requisitos": [], "creditos": 2},
            {"id": "PA140", "nombre": "GestiÃ³n Empresarial", "ciclo": 12, "requisitos": ["BEG01", "BRN01"], "creditos": 3},
            {"id": "AS920", "nombre": "Aprovechamiento de Recursos HÃ­dricos", "ciclo": 12, "requisitos": ["SA216"], "creditos": 4},
            {"id": "EC511", "nombre": "MecÃ¡nica de Suelos I", "ciclo": 12, "requisitos": ["AA215"], "creditos": 4},
            {"id": "EE342", "nombre": "Instalaciones ElÃ©ctricas Interiores", "ciclo": 12, "requisitos": ["F1413"], "creditos": 3},
            {"id": "MA074", "nombre": "MatemÃ¡tica Financiera", "ciclo": 12, "requisitos": ["BMA02"], "creditos": 3},
            {"id": "PA425", "nombre": "DiseÃ±o y EvaluaciÃ³n de Proyectos", "ciclo": 12, "requisitos": ["BEG01", "MA074"], "creditos": 4}
        ];

        const container = document.getElementById('container');
        const progressBar = document.getElementById('progressBar');
        const motivationMessage = document.getElementById('motivation-message');
        const progressCreditsText = document.getElementById('progress-credits-text');

        const aprobados = new Set(JSON.parse(localStorage.getItem("aprobados") || "[]"));
        const totalRamos = ramos.length;
        const totalCreditosCarrera = 215; // Total de crÃ©ditos para la carrera
        const creditosParaTitulo = 220; // Total de crÃ©ditos para el tÃ­tulo (215 de malla + 5 adicionales)

        // Variable para almacenar los crÃ©ditos actuales aprobados de la malla
        let currentCreditosMallaAprobados = 0;

        function calculateCurrentCreditosMallaAprobados() {
            let sumCreditos = 0;
            aprobados.forEach(ramoId => {
                const ramo = ramos.find(r => r.id === ramoId);
                if (ramo) {
                    sumCreditos += ramo.creditos;
                }
            });
            currentCreditosMallaAprobados = sumCreditos;
        }

        function updateProgressBar() {
            // La barra de progreso visual sigue basÃ¡ndose en los 215 crÃ©ditos de la malla
            const percentage = totalCreditosCarrera > 0 ? Math.round((currentCreditosMallaAprobados / totalCreditosCarrera) * 100) : 0;

            progressBar.style.width = `${percentage}%`;
            progressBar.textContent = `${percentage}%`;

            // LÃ³gica para el mensaje de motivaciÃ³n
            if (currentCreditosMallaAprobados >= totalCreditosCarrera) {
                motivationMessage.textContent = "Â¡Felicidades! Has completado todos los crÃ©ditos de la malla. Ya casi eres Ingeniero Sanitario, solo te faltan 5 crÃ©ditos que podrÃ¡s conseguir por tus horas extracurriculares, idiomas y prÃ¡cticas.";
                progressBar.style.background = 'linear-gradient(to right, #28a745, #218838)'; // Verde mÃ¡s oscuro al completar
            } else if (percentage >= 75) {
                motivationMessage.textContent = "Â¡EstÃ¡s en la recta final! Sigue asÃ­, la meta estÃ¡ cerca.";
                progressBar.style.background = 'linear-gradient(to right, #4CAF50, #8BC34A)';
            } else if (percentage >= 50) {
                motivationMessage.textContent = "Â¡MÃ¡s de la mitad del camino recorrido! Vas muy bien.";
                progressBar.style.background = 'linear-gradient(to right, #4CAF50, #8BC34A)';
            } else if (percentage > 0) {
                motivationMessage.textContent = "Cada crÃ©dito te acerca mÃ¡s a tu objetivo. Â¡No te rindas!";
                progressBar.style.background = 'linear-gradient(to right, #4CAF50, #8BC34A)';
            } else {
                motivationMessage.textContent = "Â¡Comienza a marcar tus cursos para ver tu avance!";
                progressBar.style.background = 'linear-gradient(to right, #4CAF50, #8BC34A)'; // Color inicial
            }
        }

        function updateCreditsProgressBar() {
            const percentageCreditos = totalCreditosCarrera > 0 ? Math.round((currentCreditosMallaAprobados / totalCreditosCarrera) * 100) : 0;
            progressCreditsText.textContent = `${currentCreditosMallaAprobados} de ${totalCreditosCarrera} crÃ©ditos aprobados (${percentageCreditos}%)`;
        }

        function render() {
            calculateCurrentCreditosMallaAprobados(); // Calcular crÃ©ditos al inicio del renderizado
            const carreraCompletaMalla = currentCreditosMallaAprobados >= totalCreditosCarrera;

            // Nueva lÃ³gica para verificar si los ciclos 1 al 4 estÃ¡n completos
            let ciclosAnterioresCompletos = true;
            for (let i = 1; i <= 4; i++) {
                const ramosEnCiclo = ramos.filter(r => r.ciclo === i);
                const todosAprobadosEnCiclo = ramosEnCiclo.every(ramo => aprobados.has(ramo.id));
                if (!todosAprobadosEnCiclo) {
                    ciclosAnterioresCompletos = false;
                    break;
                }
            }

            container.innerHTML = '';
            for (let i = 1; i <= 12; i++) {
                const cicloDiv = document.createElement("div");
                cicloDiv.className = "ciclo";
                cicloDiv.innerHTML =
                    i === 11 ? "<h2>Electivos de Especialidad</h2>" :
                    i === 12 ? "<h2>Electivos Complementarios</h2>" :
                    "<h2>Ciclo " + i + "</h2>";
                ramos.filter(r => r.ciclo === i).forEach(ramo => {
                    const btn = document.createElement("button");
                    btn.textContent = `${ramo.nombre} (${ramo.creditos} crÃ©ditos)`; // Mostrar crÃ©ditos
                    btn.className = "ramo";
                    btn.id = ramo.id;

                    const yaAprobado = aprobados.has(ramo.id);
                    const puedeAprobarRequisitos = ramo.requisitos.length === 0 || ramo.requisitos.every(req => aprobados.has(req));

                    let shouldBeDisabled = !yaAprobado && (carreraCompletaMalla || !puedeAprobarRequisitos);

                    // LÃ³gica especÃ­fica para electivos: deshabilitar si los ciclos anteriores no estÃ¡n completos
                    if ((ramo.ciclo === 11 || ramo.ciclo === 12) && !ciclosAnterioresCompletos && !yaAprobado) {
                        shouldBeDisabled = true;
                    }

                    btn.disabled = shouldBeDisabled;

                    if (yaAprobado) {
                        btn.classList.add("aprobado");
                    }

                    btn.onclick = () => {
                        if (yaAprobado) {
                            // Si el curso ya estÃ¡ aprobado, desaprobarlo
                            aprobados.delete(ramo.id);
                            // TambiÃ©n desaprobar cualquier curso que dependa de este
                            ramos.forEach(r => {
                                if (r.requisitos.includes(ramo.id) && aprobados.has(r.id)) {
                                    aprobados.delete(r.id);
                                }
                            });
                        } else {
                            // Si el curso no estÃ¡ aprobado y sus requisitos sÃ­, y la malla no estÃ¡ completa, aprobarlo
                            if (puedeAprobarRequisitos && !carreraCompletaMalla) {
                                // Verificar la condiciÃ³n de electivos antes de aprobar
                                if ((ramo.ciclo === 11 || ramo.ciclo === 12) && !ciclosAnterioresCompletos) {
                                    alert("Debes completar todos los cursos hasta el Ciclo 4 (inclusive) para poder seleccionar cursos electivos.");
                                    return;
                                }
                                aprobados.add(ramo.id);
                                btn.animate([{transform: "scale(1)"}, {transform: "scale(1.05)"}, {transform: "scale(1)"}], {
                                    duration: 300
                                });
                            } else if (carreraCompletaMalla) {
                                alert("Has completado los crÃ©ditos de la malla. Los 5 crÃ©ditos restantes se obtienen por horas extracurriculares, idiomas y prÃ¡cticas.");
                                return;
                            } else {
                                alert("Debes aprobar los requisitos previos para este curso.");
                                return;
                            }
                        }
                        localStorage.setItem("aprobados", JSON.stringify([...aprobados]));
                        render(); // Volver a renderizar para actualizar estados y barra de progreso
                    };
                    cicloDiv.appendChild(btn);
                });
                container.appendChild(cicloDiv);
            }
            updateProgressBar();
            updateCreditsProgressBar();
        }

        document.getElementById("resetBtn").onclick = () => {
            if (confirm("Â¿EstÃ¡s seguro de que quieres reiniciar todo tu progreso? Esta acciÃ³n no se puede deshacer.")) {
                localStorage.removeItem("aprobados");
                aprobados.clear();
                render();
            }
        };

        render();
    </script>
</body>
</html>
